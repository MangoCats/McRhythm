# Test Specification: TC-U-001-01

## Test Metadata

| Field | Value |
|-------|-------|
| **Test ID** | TC-U-001-01 |
| **Test Type** | Unit Test |
| **Requirement** | FR-001 (Centralized Parameter Storage) |
| **Priority** | HIGH |
| **Estimated Effort** | 10 minutes |

---

## Test Description

**Objective:** Verify that `GlobalParams` struct contains all 15 parameter fields defined in SPEC016

**Scope:** `wkmp-common::params::GlobalParams` struct definition

---

## Test Specification (BDD Format)

### Given
- `wkmp-common/src/params.rs` exists
- `GlobalParams` struct is defined

### When
- Code inspection or reflection examines struct fields

### Then
- Struct has exactly 15 public fields
- Each field is of type `RwLock<T>` where T matches SPEC016 type
- Field names match SPEC016 parameter names

---

## Test Implementation

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_global_params_has_all_fields() {
        // Verify all 15 parameters exist by accessing them
        let params = GlobalParams::default();

        // DBD-PARAM-010
        let _ = params.volume_level.read().unwrap();

        // DBD-PARAM-020
        let _ = params.working_sample_rate.read().unwrap();

        // DBD-PARAM-030
        let _ = params.output_ringbuffer_size.read().unwrap();

        // DBD-PARAM-040
        let _ = params.output_refill_period.read().unwrap();

        // DBD-PARAM-050
        let _ = params.maximum_decode_streams.read().unwrap();

        // DBD-PARAM-060
        let _ = params.decode_work_period.read().unwrap();

        // DBD-PARAM-065
        let _ = params.decode_chunk_size.read().unwrap();

        // DBD-PARAM-070
        let _ = params.playout_ringbuffer_size.read().unwrap();

        // DBD-PARAM-080
        let _ = params.playout_ringbuffer_headroom.read().unwrap();

        // DBD-PARAM-085
        let _ = params.decoder_resume_hysteresis_samples.read().unwrap();

        // DBD-PARAM-088
        let _ = params.mixer_min_start_level.read().unwrap();

        // DBD-PARAM-090
        let _ = params.pause_decay_factor.read().unwrap();

        // DBD-PARAM-100
        let _ = params.pause_decay_floor.read().unwrap();

        // DBD-PARAM-110
        let _ = params.audio_buffer_size.read().unwrap();

        // DBD-PARAM-111
        let _ = params.mixer_check_interval_ms.read().unwrap();

        // If we reach here, all 15 fields exist and are accessible
        assert!(true, "All 15 parameter fields exist");
    }

    #[test]
    fn test_parameter_field_types() {
        let params = GlobalParams::default();

        // Verify types (compile-time check via type inference)
        let _: f32 = *params.volume_level.read().unwrap();
        let _: u32 = *params.working_sample_rate.read().unwrap();
        let _: usize = *params.output_ringbuffer_size.read().unwrap();
        let _: u64 = *params.output_refill_period.read().unwrap();
        let _: usize = *params.maximum_decode_streams.read().unwrap();
        let _: u64 = *params.decode_work_period.read().unwrap();
        let _: usize = *params.decode_chunk_size.read().unwrap();
        let _: usize = *params.playout_ringbuffer_size.read().unwrap();
        let _: usize = *params.playout_ringbuffer_headroom.read().unwrap();
        let _: u64 = *params.decoder_resume_hysteresis_samples.read().unwrap();
        let _: usize = *params.mixer_min_start_level.read().unwrap();
        let _: f64 = *params.pause_decay_factor.read().unwrap();
        let _: f64 = *params.pause_decay_floor.read().unwrap();
        let _: u32 = *params.audio_buffer_size.read().unwrap();
        let _: u64 = *params.mixer_check_interval_ms.read().unwrap();
    }
}
```

---

## Verification Steps

### Automated Verification
```bash
cargo test --package wkmp-common test_global_params_has_all_fields
cargo test --package wkmp-common test_parameter_field_types
```

### Expected Output
```
test params::tests::test_global_params_has_all_fields ... ok
test params::tests::test_parameter_field_types ... ok

test result: ok. 2 passed; 0 failed
```

---

## Pass Criteria

**Test PASSES if:**
- Both test functions compile successfully
- Both test functions execute without panic
- All 15 field accesses succeed
- All type annotations match expected types

**Test FAILS if:**
- Compilation error (field does not exist)
- Runtime panic (RwLock poisoned)
- Type mismatch error
- Fewer than 15 fields accessible

---

## Failure Handling

**If test fails:**
1. Check `wkmp-common/src/params.rs` for GlobalParams definition
2. Verify all 15 fields are declared as `pub field_name: RwLock<Type>`
3. Verify field names match SPEC016 parameter names
4. Check for typos in field names
5. Verify RwLock imported from std::sync

**Common Issues:**
- Missing field: Add field to struct definition
- Wrong type: Correct type per SPEC016 table
- Private field: Add `pub` keyword

---

## Dependencies

**Test Depends On:**
- `wkmp-common/src/params.rs` exists
- GlobalParams struct defined
- All 15 fields declared

**No External Dependencies**

---

## Test Data

**N/A** - This test uses default GlobalParams instance, no external data required

---

## Traceability

**Requirements Verified:**
- FR-001: Centralized Parameter Storage (partial - verifies struct exists)

**Related Tests:**
- TC-U-001-02: Verifies default values
- TC-I-004-01: Verifies database loading

---

## Notes

- This test verifies structure, not behavior
- Compile-time check ensures correct types
- Runtime check ensures RwLock not poisoned at initialization

---

**Test Status:** Ready for Implementation
**Created:** 2025-11-02
**Last Updated:** 2025-11-02
