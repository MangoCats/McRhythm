# Test Specification: TC-U-010-01 - Directory Structure Validation

**Test ID:** TC-U-010-01
**Requirement:** REQ-DEBT-QUALITY-002-010 (Module Split)
**Type:** Unit Test
**Scope:** File system structure
**Estimated Effort:** 5 minutes to write + implement

---

## Test Objective

Verify that engine.rs has been converted from a single file to a directory structure with the correct module files.

---

## Test Specification

**Given:** Refactoring has been completed

**When:** File system is inspected

**Then:** The following structure exists:

```
wkmp-ap/src/playback/
├── engine/              # Directory (not engine.rs file)
│   ├── mod.rs          # Module interface (re-exports)
│   ├── core.rs         # State management and lifecycle
│   ├── queue.rs        # Queue operations
│   └── diagnostics.rs  # Status queries and telemetry
```

---

## Verification Steps

**Step 1:** Verify engine.rs file does NOT exist
```bash
! test -f wkmp-ap/src/playback/engine.rs
```
**Expected:** File does not exist (command succeeds)

**Step 2:** Verify engine/ directory exists
```bash
test -d wkmp-ap/src/playback/engine
```
**Expected:** Directory exists (command succeeds)

**Step 3:** Verify mod.rs exists
```bash
test -f wkmp-ap/src/playback/engine/mod.rs
```
**Expected:** File exists

**Step 4:** Verify core.rs exists
```bash
test -f wkmp-ap/src/playback/engine/core.rs
```
**Expected:** File exists

**Step 5:** Verify queue.rs exists
```bash
test -f wkmp-ap/src/playback/engine/queue.rs
```
**Expected:** File exists

**Step 6:** Verify diagnostics.rs exists
```bash
test -f wkmp-ap/src/playback/engine/diagnostics.rs
```
**Expected:** File exists

**Step 7:** Verify no extra files in engine/
```bash
ls wkmp-ap/src/playback/engine/ | wc -l
```
**Expected:** Exactly 4 files

---

## Automated Test Implementation

**Option A: Bash Script**

```bash
#!/bin/bash
# tc_u_010_01_directory_structure.sh

cd wkmp-ap

echo "TC-U-010-01: Directory Structure Validation"

# Check old file doesn't exist
if [ -f src/playback/engine.rs ]; then
    echo "FAIL: engine.rs file still exists (should be directory)"
    exit 1
fi

# Check directory exists
if [ ! -d src/playback/engine ]; then
    echo "FAIL: engine/ directory does not exist"
    exit 1
fi

# Check required files
required_files=("mod.rs" "core.rs" "queue.rs" "diagnostics.rs")
for file in "${required_files[@]}"; do
    if [ ! -f "src/playback/engine/$file" ]; then
        echo "FAIL: Missing file: $file"
        exit 1
    fi
done

# Check file count (no extras)
file_count=$(ls src/playback/engine/ | wc -l)
if [ "$file_count" -ne 4 ]; then
    echo "FAIL: Expected 4 files, found $file_count"
    exit 1
fi

echo "PASS: Directory structure correct"
exit 0
```

**Option B: Rust Test (Compile-Time Check)**

```rust
#[test]
fn test_engine_module_structure() {
    // If this compiles, module structure exists
    use crate::playback::engine;

    // Verify re-exports work (public API accessible)
    let _ = engine::PlaybackEngine::new; // Function exists

    // Note: Cannot directly test file structure at runtime in Rust
    // Use bash script (Option A) for file system validation
}
```

---

## Pass Criteria

✅ **Pass If:**
- engine.rs file does NOT exist
- engine/ directory exists
- All 4 required files exist: mod.rs, core.rs, queue.rs, diagnostics.rs
- No extra files in engine/ directory
- Exit code 0

❌ **Fail If:**
- engine.rs file still exists
- engine/ directory missing
- Any required file missing
- Extra files present (e.g., backup files, .swp files)
- Exit code non-zero

---

## Fail Criteria Details

**Failure Mode 1: Old file still exists**
- Symptom: `engine.rs` file present
- Likely Cause: Refactoring not started or incomplete
- Action: Complete file-to-directory conversion

**Failure Mode 2: Missing module files**
- Symptom: One or more of mod.rs/core.rs/queue.rs/diagnostics.rs missing
- Likely Cause: Incomplete refactoring
- Action: Create missing modules

**Failure Mode 3: Extra files**
- Symptom: More than 4 files in engine/
- Likely Cause: Backup files, editor temp files, or additional modules
- Action: Remove unnecessary files OR update test if additional modules justified

---

## Test Data

**No external test data required** - This test inspects file system only.

---

## Dependencies

**Prerequisites:**
- Refactoring implementation completed
- File system accessible

**No external dependencies.**

---

## Execution Context

**When to Run:**
- After initial module creation (Increment 1)
- After final code migration (Increment N)
- As part of CI/CD pipeline
- Before marking refactoring complete

**Execution Time:** <5 seconds

---

## Traceability

**Requirement:** REQ-DEBT-QUALITY-002-010
**Acceptance Criterion:** "3 modules + 1 interface file exist in correct structure"
**Related Tests:** TC-I-010-01 (compilation), TC-S-010-01 (file count)

---

**Test Specification Complete**
**Status:** Ready for implementation
